#!/bin/bash

readonly AWS_ACCOUNT=$1
readonly EC2_NAME_TAG=$2
readonly KIND_OF_IP=$3
readonly INSTANCE_STATE=$4

if [ -z $KIND_OF_IP ]; then
  ip_type='PrivateIpAddress'
elif [ $KIND_OF_IP = 'private' ]; then
  ip_type='PrivateIpAddress'
elif [ $KIND_OF_IP = 'public' ]; then
  ip_type='PublicIpAddress'
else
  echo 'usage: show-ip [AWS_ACCOUNT_PROFILE] [EC2_NAME_TAG] [Option private or public]'
  exit 1
fi

if [ -z $AWS_ACCOUNT ]; then
  echo 'usage: show-ip [AWS_ACCOUNT_PROFILE] [EC2_NAME_TAG] [Option private or public]'
  exit 2
fi

if [ -z $EC2_NAME_TAG ]; then
  echo 'usage: show-ip [AWS_ACCOUNT_PROFILE] [EC2_NAME_TAG] [Option private or public]'
  exit 3
fi

if [ -z $KIND_OF_IP ]; then
  state='running'
fi

aws --profile $AWS_ACCOUNT ec2 describe-instances | \
  jq -cr ".Reservations[].Instances[] \
  | select(.State.Name==\"${state}\") \
  | select(.Tags[].Key==\"Name\") \
  | select(.Tags[].Value==\"${EC2_NAME_TAG}\").${ip_type}"
